{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.11.5", "generated_at": "2026-02-16T12:57:25.665289Z", "invocation_id": "5b79fc17-aa81-4754-881c-532873777587", "invocation_started_at": "2026-02-16T12:57:24.888336Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.540401Z", "completed_at": "2026-02-16T12:57:25.551748Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.553312Z", "completed_at": "2026-02-16T12:57:25.553329Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.013638734817504883, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.frontier_analytics.stg_crm__companies", "compiled": true, "compiled_code": "with source as (\n\n    select * from \"FBS_DB\".\"CRM\".\"Company\"\n\n),\n\nrenamed as (\n\n    select\n        \"Comp_CompanyId\"    as company_id,\n        \"Comp_Name\"         as company_name,\n        \"Comp_Sector\"       as sector_code,\n        \"Comp_PrimaryUserId\" as primary_user_id,\n        \"comp_blocks\"       as block_code\n    from source\n\n)\n\nselect * from renamed", "relation_name": "\"FBS_DB\".\"dbt_dev_staging\".\"stg_crm__companies\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.548380Z", "completed_at": "2026-02-16T12:57:25.552873Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.557892Z", "completed_at": "2026-02-16T12:57:25.557909Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.01201319694519043, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.frontier_analytics.stg_crm__custom_captions", "compiled": true, "compiled_code": "with source as (\n\n    select * from \"FBS_DB\".\"CRM\".\"Custom_Captions\"\n\n),\n\nrenamed as (\n\n    select\n        \"Capt_Code\"     as caption_code,\n        \"Capt_Family\"   as caption_family,\n        \"Capt_US\"       as caption_value\n    from source\n\n)\n\nselect * from renamed", "relation_name": "\"FBS_DB\".\"dbt_dev_staging\".\"stg_crm__custom_captions\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.554394Z", "completed_at": "2026-02-16T12:57:25.561182Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.564273Z", "completed_at": "2026-02-16T12:57:25.564282Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.013008594512939453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.frontier_analytics.stg_crm__opportunities", "compiled": true, "compiled_code": "with source as (\n\n    select * from \"FBS_DB\".\"CRM\".\"Opportunity\"\n\n),\n\nrenamed as (\n\n    select\n        \"Oppo_OpportunityId\"    as opportunity_id,\n        \"Oppo_PrimaryCompanyId\" as company_id,\n        \"Oppo_AssignedUserId\"   as assigned_user_id,\n        \"Oppo_CreatedBy\"        as created_by_user_id,\n        \"Oppo_Opened\"           as opened_at,\n        \"Oppo_TargetClose\"      as target_close_date,\n        \"Oppo_UpdatedDate\"      as updated_at,\n        \"Oppo_Stage\"            as stage,\n        \"Oppo_Certainty\"        as certainty,\n        \"Oppo_Forecast\"         as forecast_topline,\n        \"Oppo_ChannelId\"        as channel_id,\n        \"oppo_segment\"          as segment,\n        \"oppo_qty\"              as quantity,\n        \"oppo_oppotype\"         as opportunity_type,\n        \"oppo_principle\"        as oem_principle,\n        \"oppo_OEM1\"             as oem_1,\n        \"oppo_OEM2\"             as oem_2,\n        \"oppo_oem3\"             as oem_3,\n        \"oppo_sbu1\"             as sbu_1_id,\n        \"oppo_SBU2\"             as sbu_2_id,\n        \"oppo_sbu3\"             as sbu_3_id,\n\n        \"oppo_SA\"               as solution_architect_code,\n        \"oppo_CRIMOFF\"          as services_subcategory,\n        \"oppo_Mustwin\"          as is_mustwin,\n        \"oppo_VPvisit\"          as is_vp_visit,\n        \"oppo_VPVISITREMARK\"    as vp_visit_remark,\n        \"oppo_bforecast\"        as forecast_bottomline,\n        \"oppo_topline1\"         as topline_1,\n        \"oppo_topline2\"         as topline_2,\n        \"oppo_topline3\"         as topline_3,\n        \"oppo_botline1\"         as bottomline_1,\n        \"oppo_botline2\"         as bottomline_2,\n        \"oppo_botline3\"         as bottomline_3\n    from source\n\n)\n\nselect * from renamed", "relation_name": "\"FBS_DB\".\"dbt_dev_staging\".\"stg_crm__opportunities\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.561537Z", "completed_at": "2026-02-16T12:57:25.566990Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.569401Z", "completed_at": "2026-02-16T12:57:25.569408Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.015559673309326172, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.frontier_analytics.stg_crm__users", "compiled": true, "compiled_code": "with source as (\n\n    select * from \"FBS_DB\".\"CRM\".\"Users\"\n\n),\n\nrenamed as (\n\n    select\n        \"User_UserId\"       as user_id,\n        \"User_FirstName\"    as first_name,\n        \"User_LastName\"     as last_name,\n        \"User_Logon\"        as logon_id,\n        concat(\"User_FirstName\", ' ', \"User_LastName\") as full_name,\n        regexp_replace(\"User_Logon\"::text, '[^0-9]', '', 'g') as employee_id\n    from source\n\n)\n\nselect * from renamed", "relation_name": "\"FBS_DB\".\"dbt_dev_staging\".\"stg_crm__users\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.565261Z", "completed_at": "2026-02-16T12:57:25.570030Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.572127Z", "completed_at": "2026-02-16T12:57:25.572142Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011534690856933594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.frontier_analytics.stg_sap__margin_sharing", "compiled": true, "compiled_code": "with source as (\n\n    select * from \"FBS_DB\".\"SAP\".\"@F_MARGINSHARING\"\n\n),\n\nrenamed as (\n\n    select\n        \"Code\"                  as code,\n        \"U_AVA_DocEntry\"::integer as order_id,\n        \"U_AVA_DocNum\"          as order_number,\n        \"U_AVA_EMPID\"           as employee_id_code,\n        \"U_AVA_SUB\"             as sbu_code,\n        \"U_AVA_SUBCATEGORY\"     as subcategory,\n        \"U_AVA_BLOCK\"           as block_code,\n        \"U_AVA_MARGIN\"          as margin_raw,\n        \"U_AVA_FMargin\"         as margin_final,\n        \"U_S_Orn\"               as source_reference\n    from source\n\n)\n\nselect * from renamed", "relation_name": "\"FBS_DB\".\"dbt_dev_staging\".\"stg_sap__margin_sharing\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.567754Z", "completed_at": "2026-02-16T12:57:25.571748Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.573419Z", "completed_at": "2026-02-16T12:57:25.573428Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.009971857070922852, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.frontier_analytics.stg_sap__order_lines", "compiled": true, "compiled_code": "with source as (\n\n    select * from \"FBS_DB\".\"SAP\".\"RDR1\"\n\n),\n\nrenamed as (\n\n    select\n        \"DocEntry\"      as order_id,\n        \"LineNum\"       as line_number,\n        \"ItemCode\"      as item_code,\n        \"Dscription\"    as item_description,\n        \"U_SSC\"         as subcategory,\n        \"LineTotal\"     as line_total,\n        \"Quantity\"      as quantity\n    from source\n\n)\n\nselect * from renamed", "relation_name": "\"FBS_DB\".\"dbt_dev_staging\".\"stg_sap__order_lines\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.577663Z", "completed_at": "2026-02-16T12:57:25.582478Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.583130Z", "completed_at": "2026-02-16T12:57:25.583138Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.010204315185546875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.frontier_analytics.stg_sap__profit_centres", "compiled": true, "compiled_code": "with source as (\n\n    select * from \"FBS_DB\".\"SAP\".\"OPRC\"\n\n),\n\nrenamed as (\n\n    select\n        \"PrcCode\"   as profit_centre_code,\n        \"PrcName\"   as profit_centre_name\n    from source\n\n)\n\nselect * from renamed", "relation_name": "\"FBS_DB\".\"dbt_dev_staging\".\"stg_sap__profit_centres\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.580084Z", "completed_at": "2026-02-16T12:57:25.583609Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.584392Z", "completed_at": "2026-02-16T12:57:25.584399Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007405757904052734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.frontier_analytics.int_crm__opportunities_expanded", "compiled": true, "compiled_code": "with opportunities as (\n\n    select * from \"FBS_DB\".\"dbt_dev_staging\".\"stg_crm__opportunities\"\n\n),\n\nusers as (\n\n    select * from \"FBS_DB\".\"dbt_dev_staging\".\"stg_crm__users\"\n\n),\n\ncompanies as (\n\n    select * from \"FBS_DB\".\"dbt_dev_staging\".\"stg_crm__companies\"\n\n),\n\ncaptions as (\n\n    select * from \"FBS_DB\".\"dbt_dev_staging\".\"stg_crm__custom_captions\"\n\n),\n\n-- Build arrays for SBU, OEM, topline, bottomline\n-- This mirrors your original view's array construction\nbase as (\n\n    select\n        o.opportunity_id,\n        o.company_id,\n        o.assigned_user_id,\n        o.created_by_user_id,\n        o.opened_at,\n        o.target_close_date,\n        o.updated_at,\n        o.stage,\n        o.certainty,\n        o.segment,\n        o.quantity,\n        o.opportunity_type,\n        o.services_subcategory,\n        o.is_mustwin,\n        o.is_vp_visit,\n        o.vp_visit_remark,\n\n        -- Assigned user details\n        assigned_user.full_name      as assigned_user_name,\n        assigned_user.employee_id    as assigned_employee_id,\n\n        -- Created by user\n        created_user.full_name       as created_by_name,\n\n        -- Company details\n        c.company_name,\n        c.sector_code,\n        c.block_code                 as company_block_code,\n\n        -- Block name from captions\n        block_cap.caption_value      as block_name,\n\n        -- Vertical from captions\n        vertical_cap.caption_value   as vertical,\n\n        -- Solution architect from captions\n        sa_cap.caption_value         as solution_architect,\n\n        -- KAM from primary user of company\n        kam_user.full_name           as kam_name,\n        kam_user.employee_id         as kam_id,\n\n        -- Certainty bucket\n        case\n            when o.certainty <= 90 then '<90'\n            when o.certainty > 90  then '>90'\n            else o.certainty::text\n        end as certainty_bucket,\n\n        -- Opportunity age in days\n        current_date - o.opened_at::date as opportunity_age_days,\n\n        -- Arrays for multi-SBU and multi-OEM expansion\n        array[\n            sbu1.caption_value,\n            sbu2.caption_value,\n            sbu3.caption_value,\n            sbu4.caption_value\n        ] as sbu_array,\n\n        array[\n            oem0.caption_value,\n            oem1.caption_value,\n            oem2.caption_value,\n            oem3.caption_value\n        ] as oem_array,\n\n        array[\n            round(o.forecast_topline, 2),\n            round(o.topline_1, 2),\n            round(o.topline_2, 2),\n            round(o.topline_3, 2)\n        ] as topline_array,\n\n        array[\n            round(o.forecast_bottomline, 2),\n            round(o.bottomline_1, 2),\n            round(o.bottomline_2, 2),\n            round(o.bottomline_3, 2)\n        ] as bottomline_array\n\n    from opportunities o\n\n    -- Assigned user\n    left join users assigned_user\n        on o.assigned_user_id = assigned_user.user_id\n\n    -- Created by user\n    left join users created_user\n        on o.created_by_user_id = created_user.user_id\n\n    -- KAM from company primary user\n    left join companies c\n        on o.company_id = c.company_id\n    left join users kam_user\n        on c.primary_user_id = kam_user.user_id\n\n    -- Block name\n    left join captions block_cap\n        on c.block_code::text = block_cap.caption_code::text\n        and block_cap.caption_family = 'oppo_principle'\n\n    -- Vertical\n    left join captions vertical_cap\n        on c.sector_code::text = vertical_cap.caption_code::text\n\n    -- Solution architect\n    left join captions sa_cap\n        on o.solution_architect_code::text = sa_cap.caption_code::text\n\n    -- SBU captions\n    left join captions sbu1\n        on o.sbu_1_id = sbu1.caption_code::integer\n        and sbu1.caption_family = 'Channels'\n    left join captions sbu2\n        on o.sbu_2_id = sbu2.caption_code::integer\n        and sbu2.caption_family = 'Channels'\n    left join captions sbu3\n        on o.sbu_3_id = sbu3.caption_code::integer\n        and sbu3.caption_family = 'Channels'\n    left join captions sbu4\n        on o.assigned_user_id = sbu4.caption_code::integer\n        and sbu4.caption_family = 'Channels'\n\n    -- OEM captions\n    left join captions oem0\n        on o.oem_principle::text = oem0.caption_code::text\n        and oem0.caption_family = 'oppo_principle'\n    left join captions oem1\n        on o.oem_1::text = oem1.caption_code::text\n        and oem1.caption_family = 'oppo_principle'\n    left join captions oem2\n        on o.oem_2::text = oem2.caption_code::text\n        and oem2.caption_family = 'oppo_principle'\n    left join captions oem3\n        on o.oem_3::text = oem3.caption_code::text\n        and oem3.caption_family = 'oppo_principle'\n\n    -- Financial year filter - dynamic current FY\n    where o.target_close_date > case\n        when extract(month from current_date) >= 4\n            then (extract(year from current_date)::text || '-04-01')::date\n        else ((extract(year from current_date) - 1)::text || '-04-01')::date\n    end\n\n),\n\n-- Unnest arrays - one row per SBU/OEM combination\n-- This is the CROSS JOIN LATERAL unnest logic from your original view\nexpanded as (\n\n    select\n        b.opportunity_id,\n        b.company_id,\n        b.assigned_user_id,\n        b.assigned_user_name,\n        b.assigned_employee_id,\n        b.created_by_name,\n        b.opened_at::date               as open_date,\n        to_char(b.opened_at, 'FMMonth') as open_month,\n        b.target_close_date::date       as close_date,\n        to_char(b.target_close_date, 'FMMonth') as close_month,\n        b.updated_at,\n        b.stage,\n        b.certainty,\n        b.certainty_bucket,\n        b.segment,\n        b.quantity,\n        b.opportunity_type,\n        b.services_subcategory,\n        b.is_mustwin,\n        b.is_vp_visit,\n        b.vp_visit_remark,\n        b.company_name,\n        b.vertical,\n        b.block_name,\n        b.solution_architect,\n        b.kam_name,\n        b.kam_id,\n        b.opportunity_age_days,\n        b.sbu_array[u.idx + 1]          as sbu,\n        b.oem_array[u.idx + 1]          as oem,\n        b.topline_array[u.idx + 1]      as topline,\n        b.bottomline_array[u.idx + 1]   as bottomline\n\n    from base b\n    cross join lateral (\n        select unnest(array[0,1,2,3]) as idx\n    ) u\n\n    -- Only keep rows where bottomline is non-zero\n    where b.bottomline_array[u.idx + 1] <> 0\n\n)\n\nselect distinct * from expanded", "relation_name": "\"FBS_DB\".\"dbt_dev_intermediate\".\"int_crm__opportunities_expanded\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.574302Z", "completed_at": "2026-02-16T12:57:25.583986Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.584878Z", "completed_at": "2026-02-16T12:57:25.584886Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.01454305648803711, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.frontier_analytics.stg_sap__orders", "compiled": true, "compiled_code": "with source as (\n\n    select * from \"FBS_DB\".\"SAP\".\"ORDR\"\n\n),\n\nrenamed as (\n\n    select\n        \"DocEntry\"          as order_id,\n        \"DocNum\"            as order_number,\n        \"DocDate\"           as order_date,\n        \"CardName\"          as customer_name,\n        \"CANCELED\"          as is_cancelled,\n        \"U_Marginpl\"::numeric as margin,\n        \"U_SBU\"             as sbu_code,\n        \"U_Ordertype\"       as order_type,\n        \"U_AVA_MARGINTYPE\"  as margin_type,\n        \"U_SalesExecutive\"  as sales_executive_code,\n        \"U_AVA_Block\"       as block_code,\n        \"U_Cgroup\"          as customer_group_code,\n        \"U_Ldcst\"           as ld_cost,\n        \"Comments\"          as comments,\n        \"U_AVA_MARGINTYPE\"  as margin_sharing_type\n\n    from source\n\n)\n\nselect * from renamed", "relation_name": "\"FBS_DB\".\"dbt_dev_staging\".\"stg_sap__orders\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.588343Z", "completed_at": "2026-02-16T12:57:25.596587Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.598005Z", "completed_at": "2026-02-16T12:57:25.598019Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.011940240859985352, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.frontier_analytics.mart_crm__pipeline", "compiled": true, "compiled_code": "with opportunities as (\n\n    select * from \"FBS_DB\".\"dbt_dev_intermediate\".\"int_crm__opportunities_expanded\"\n\n),\n\naccount_type as (\n\n    select * from \"FBS_DB\".\"Excel_Data\".\"CRM_Account_Type_Mapping\"\n\n),\n\nsbu_target as (\n\n    select * from \"FBS_DB\".\"Excel_Data\".\"SBU_Target\"\n\n),\n\nfinal as (\n\n    select distinct\n        o.opportunity_id,\n        o.company_id,\n        o.open_date,\n        o.open_month,\n        o.close_date,\n        o.close_month,\n        o.assigned_user_name        as opportunity_assigned_user,\n        o.assigned_employee_id      as empl_id,\n        o.kam_name,\n        o.kam_id,\n        o.block_name                as block,\n        o.stage,\n        o.certainty,\n        o.certainty_bucket,\n        o.segment                   as category,\n        o.company_name,\n        o.vertical,\n        o.sbu,\n        o.oem,\n        o.quantity,\n        o.topline,\n        o.bottomline,\n        o.opportunity_age_days      as opportunity_age,\n        o.opportunity_type          as tender,\n        o.services_subcategory,\n        o.solution_architect,\n        o.is_mustwin,\n        o.is_vp_visit,\n        o.vp_visit_remark           as remark,\n        o.created_by_name           as opportunity_created_by,\n        o.updated_at                as last_modify_date,\n        coalesce(at.\"Final Ac Type\", 'OTHER') as final_ac_type,\n        st.\"Region\"                 as region,\n        st.\"Block Head\"             as block_head\n\n    from opportunities o\n\n    left join account_type at\n        on o.segment::text = at.\"CRM\"::text\n\n    left join sbu_target st\n        on o.block_name = st.\"Block\"::text\n\n)\n\nselect * from final", "relation_name": "\"FBS_DB\".\"dbt_dev_marts\".\"mart_crm__pipeline\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.592006Z", "completed_at": "2026-02-16T12:57:25.597386Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.598766Z", "completed_at": "2026-02-16T12:57:25.598773Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011118650436401367, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.frontier_analytics.int_sap__orders_not_sharing", "compiled": true, "compiled_code": "with orders as (\n\n    select * from \"FBS_DB\".\"dbt_dev_staging\".\"stg_sap__orders\"\n\n),\n\norder_lines as (\n\n    select * from \"FBS_DB\".\"dbt_dev_staging\".\"stg_sap__order_lines\"\n\n),\n\nprofit_centres as (\n\n    select * from \"FBS_DB\".\"dbt_dev_staging\".\"stg_sap__profit_centres\"\n\n),\n\n-- Join orders to get one row per order (not per line)\n-- rn = 1 ensures we take only the first line per order\n-- This matches your original view logic exactly\norders_with_lines as (\n\n    select\n        o.order_id,\n        o.order_number,\n        o.order_date,\n        o.customer_name,\n        o.margin,\n        o.sbu_code,\n        o.order_type,\n        o.margin_type,\n        o.sales_executive_code,\n        o.block_code,\n        o.customer_group_code,\n        o.ld_cost,\n        o.comments,\n        lower(l.subcategory) as subcategory,\n        'Not Sharing' as sharing_type,\n        row_number() over (partition by l.order_id) as rn\n\n    from orders o\n    join order_lines l on l.order_id = o.order_id\n\n    -- Your original filters\n    where o.margin <> 0\n      and o.is_cancelled = 'N'\n      and o.margin_sharing_type = 'NS'\n      and (lower(l.subcategory) not like '%is%' or l.subcategory is null)\n      and (o.sbu_code is null\n           or o.sbu_code not in ('POWER SERVICE', 'SPWR'))\n\n),\n\n-- Clean employee ID - strip E000 prefix (your original CASE logic)\nemployee_id_cleaned as (\n\n    select\n        order_id,\n        order_number,\n        order_date,\n        customer_name,\n        margin,\n        sbu_code,\n        order_type,\n        margin_type,\n        block_code,\n        customer_group_code,\n        ld_cost,\n        comments,\n        subcategory,\n        sharing_type,\n        rn,\n        case\n            when left(replace(sales_executive_code, 'E000', ''), 1) = '0'\n                then right(replace(sales_executive_code, 'E000', ''), 3)\n            when sales_executive_code = 'DIR00001'\n                then '1'\n            else replace(sales_executive_code, 'E000', '')\n        end as employee_id,\n        sales_executive_code as kam_profit_centre_code\n\n    from orders_with_lines\n    where rn = 1\n\n)\n\nselect * from employee_id_cleaned", "relation_name": "\"FBS_DB\".\"dbt_dev_intermediate\".\"int_sap__orders_not_sharing\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.594384Z", "completed_at": "2026-02-16T12:57:25.597643Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.599252Z", "completed_at": "2026-02-16T12:57:25.599259Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.011278390884399414, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.frontier_analytics.int_sap__orders_sharing", "compiled": true, "compiled_code": "with margin_sharing as (\n\n    select * from \"FBS_DB\".\"dbt_dev_staging\".\"stg_sap__margin_sharing\"\n\n),\n\norders as (\n\n    select * from \"FBS_DB\".\"dbt_dev_staging\".\"stg_sap__orders\"\n\n),\n\norder_lines as (\n\n    select * from \"FBS_DB\".\"dbt_dev_staging\".\"stg_sap__order_lines\"\n\n),\n\n-- Replicate your original @F_MARGINSHARING logic\n-- Final margin = margin_final if available, else clean margin_raw\nmargin_calculated as (\n\n    select\n        code,\n        order_id,\n        employee_id_code,\n        sbu_code,\n        subcategory,\n        block_code,\n        source_reference,\n        margin_raw,\n        margin_final,\n        case\n            when margin_final is null\n                then regexp_replace(margin_raw::text, '[^0-9-]', '', 'g')::numeric\n            else margin_final::numeric\n        end as margin\n\n    from margin_sharing\n\n),\n\n-- Join to ORDR to get order header details\njoined as (\n\n    select\n        o.order_number,\n        o.comments,\n        mc.order_id,\n        o.order_date,\n        mc.margin,\n        mc.sbu_code,\n        o.order_type,\n        o.margin_sharing_type,\n        mc.employee_id_code,\n        mc.block_code,\n        o.customer_group_code,\n        o.customer_name,\n        o.ld_cost,\n        lower(mc.subcategory) as subcategory,\n        'Sharing' as sharing_type,\n        row_number() over (partition by mc.order_id) as rn\n\n    from margin_calculated mc\n    left join orders o on o.order_id = mc.order_id\n    left join order_lines l on l.order_id = mc.order_id\n\n    where (\n            coalesce(regexp_replace(mc.margin_raw::text, '[^0-9.-]', '', 'g')::numeric, 0) +\n            coalesce(mc.margin_final::numeric, 0)\n          ) <> 0\n      and o.is_cancelled = 'N'\n      and o.margin_sharing_type = 'S'\n      and (lower(mc.subcategory) not like '%is%' or mc.subcategory is null)\n      and (mc.sbu_code is null\n           or mc.sbu_code not in ('POWER SERVICE', 'SPWR'))\n\n),\n\n-- Clean employee ID - same logic as not sharing\nemployee_id_cleaned as (\n\n    select\n        order_id,\n        order_number,\n        order_date,\n        customer_name,\n        margin,\n        sbu_code,\n        order_type,\n        margin_sharing_type,\n        block_code,\n        customer_group_code,\n        ld_cost,\n        comments,\n        subcategory,\n        sharing_type,\n        rn,\n        case\n            when left(replace(employee_id_code, 'E000', ''), 1) = '0'\n                then right(replace(employee_id_code, 'E000', ''), 3)\n            else replace(employee_id_code, 'E000', '')\n        end as employee_id,\n        employee_id_code as kam_profit_centre_code\n\n    from joined\n    where rn = 1\n\n)\n\nselect * from employee_id_cleaned", "relation_name": "\"FBS_DB\".\"dbt_dev_intermediate\".\"int_sap__orders_sharing\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.601441Z", "completed_at": "2026-02-16T12:57:25.612320Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.617085Z", "completed_at": "2026-02-16T12:57:25.617106Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.016535043716430664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.frontier_analytics.not_null_mart_crm__pipeline_bottomline.bb0ad7aa02", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect bottomline\nfrom \"FBS_DB\".\"dbt_dev_marts\".\"mart_crm__pipeline\"\nwhere bottomline is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.613357Z", "completed_at": "2026-02-16T12:57:25.623808Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.625319Z", "completed_at": "2026-02-16T12:57:25.625330Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.014753341674804688, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.frontier_analytics.not_null_mart_crm__pipeline_opportunity_id.32fb96ac7f", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect opportunity_id\nfrom \"FBS_DB\".\"dbt_dev_marts\".\"mart_crm__pipeline\"\nwhere opportunity_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.617940Z", "completed_at": "2026-02-16T12:57:25.624669Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.626033Z", "completed_at": "2026-02-16T12:57:25.626047Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.014602899551391602, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.frontier_analytics.not_null_mart_crm__pipeline_stage.8125fe3e37", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect stage\nfrom \"FBS_DB\".\"dbt_dev_marts\".\"mart_crm__pipeline\"\nwhere stage is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.620835Z", "completed_at": "2026-02-16T12:57:25.626808Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.627536Z", "completed_at": "2026-02-16T12:57:25.627545Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.014940977096557617, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.frontier_analytics.int_sap__orders_combined", "compiled": true, "compiled_code": "with not_sharing as (\n\n    select * from \"FBS_DB\".\"dbt_dev_intermediate\".\"int_sap__orders_not_sharing\"\n\n),\n\nsharing as (\n\n    select * from \"FBS_DB\".\"dbt_dev_intermediate\".\"int_sap__orders_sharing\"\n\n),\n\nprofit_centres as (\n\n    select * from \"FBS_DB\".\"dbt_dev_staging\".\"stg_sap__profit_centres\"\n\n),\n\n-- Union both streams together with matching columns\ncombined as (\n\n    select\n        order_id,\n        order_number,\n        order_date,\n        customer_name,\n        margin,\n        sbu_code,\n        order_type,\n        block_code,\n        customer_group_code,\n        ld_cost,\n        comments,\n        subcategory,\n        sharing_type,\n        employee_id,\n        kam_profit_centre_code\n\n    from not_sharing\n\n    union all\n\n    select\n        order_id,\n        order_number,\n        order_date,\n        customer_name,\n        margin,\n        sbu_code,\n        order_type,\n        block_code,\n        customer_group_code,\n        ld_cost,\n        comments,\n        subcategory,\n        sharing_type,\n        employee_id,\n        kam_profit_centre_code\n\n    from sharing\n\n),\n\n-- Join profit centres twice - once for block name, once for KAM name\n-- This mirrors your original view joining OPRC twice with different aliases\nenriched as (\n\n    select\n        c.order_id,\n        c.order_number,\n        c.order_date,\n        c.customer_name,\n        c.margin,\n        c.sbu_code,\n        c.order_type,\n        c.ld_cost,\n        c.comments,\n        c.subcategory,\n        c.sharing_type,\n        c.employee_id,\n        c.customer_group_code,\n        block_pc.profit_centre_name   as block_name,\n        kam_pc.profit_centre_name     as kam_name,\n\n        -- Indian financial year quarter mapping\n        case\n            when extract(month from c.order_date) in (4,5,6)   then 'Q1'\n            when extract(month from c.order_date) in (7,8,9)   then 'Q2'\n            when extract(month from c.order_date) in (10,11,12) then 'Q3'\n            when extract(month from c.order_date) in (1,2,3)   then 'Q4'\n        end as financial_quarter,\n\n        -- Month name mapping\n        case extract(month from c.order_date)\n            when 1  then 'January'\n            when 2  then 'February'\n            when 3  then 'March'\n            when 4  then 'April'\n            when 5  then 'May'\n            when 6  then 'June'\n            when 7  then 'July'\n            when 8  then 'August'\n            when 9  then 'September'\n            when 10 then 'October'\n            when 11 then 'November'\n            when 12 then 'December'\n        end as month_name,\n\n        date_trunc('month', c.order_date) as order_month\n\n    from combined c\n    left join profit_centres block_pc\n        on c.block_code = block_pc.profit_centre_code\n    left join profit_centres kam_pc\n        on c.kam_profit_centre_code = kam_pc.profit_centre_code\n\n)\n\nselect * from enriched", "relation_name": "\"FBS_DB\".\"dbt_dev_intermediate\".\"int_sap__orders_combined\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.629443Z", "completed_at": "2026-02-16T12:57:25.631724Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.632009Z", "completed_at": "2026-02-16T12:57:25.632014Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.003106832504272461, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.frontier_analytics.mart_sap__sales_orders", "compiled": true, "compiled_code": "with orders as (\n\n    select * from \"FBS_DB\".\"dbt_dev_intermediate\".\"int_sap__orders_combined\"\n\n),\n\nsbu_mapping as (\n\n    select * from \"FBS_DB\".\"Excel_Data\".\"SBU_Name_Master\"\n\n),\n\naccount_type as (\n\n    select * from \"FBS_DB\".\"Excel_Data\".\"SAP_Account_Type_Mapping\"\n\n),\n\nsbu_target as (\n\n    select * from \"FBS_DB\".\"Excel_Data\".\"SBU_Target\"\n\n),\n\nfinal as (\n\n    select distinct\n        o.order_number              as so_number,\n        o.comments                  as orn,\n        o.order_id,\n        o.order_date,\n        o.order_month,\n        o.margin,\n        coalesce(sbu.\"SBU Name\", o.sbu_code) as sbu,\n        o.kam_name,\n        o.block_name                as block,\n        o.order_type,\n        o.subcategory,\n        o.customer_name,\n        o.sharing_type,\n        o.financial_quarter,\n        o.month_name,\n        o.ld_cost,\n        o.employee_id,\n        at.\"Final Ac Type\"          as account_type,\n        st.\"Region\"                 as region\n\n    from orders o\n\n    left join sbu_mapping sbu\n        on o.sbu_code = sbu.\"PrcName\"\n\n    left join account_type at\n        on o.customer_group_code = at.\"SAP\"\n\n    left join sbu_target st\n        on o.block_name = st.\"Block\"\n\n    where o.order_date >= case\n        when extract(month from current_date) >= 4\n            then (extract(year from current_date)::text || '-04-01')::date\n        else ((extract(year from current_date) - 1)::text || '-04-01')::date\n    end\n\n    order by o.order_number\n\n)\n\nselect * from final", "relation_name": "\"FBS_DB\".\"dbt_dev_marts\".\"mart_sap__sales_orders\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.633870Z", "completed_at": "2026-02-16T12:57:25.642893Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.644416Z", "completed_at": "2026-02-16T12:57:25.644439Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011129379272460938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.frontier_analytics.accepted_values_mart_sap__sales_orders_financial_quarter__Q1__Q2__Q3__Q4.d9e86aa47e", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        financial_quarter as value_field,\n        count(*) as n_records\n\n    from \"FBS_DB\".\"dbt_dev_marts\".\"mart_sap__sales_orders\"\n    group by financial_quarter\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'Q1','Q2','Q3','Q4'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.645369Z", "completed_at": "2026-02-16T12:57:25.654546Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.655940Z", "completed_at": "2026-02-16T12:57:25.655948Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.014486312866210938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.frontier_analytics.accepted_values_mart_sap__sales_orders_sharing_type__Sharing__Not_Sharing.e2881c2f1f", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        sharing_type as value_field,\n        count(*) as n_records\n\n    from \"FBS_DB\".\"dbt_dev_marts\".\"mart_sap__sales_orders\"\n    group by sharing_type\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'Sharing','Not Sharing'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.649287Z", "completed_at": "2026-02-16T12:57:25.655101Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.656937Z", "completed_at": "2026-02-16T12:57:25.656947Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.013768911361694336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.frontier_analytics.not_null_mart_sap__sales_orders_margin.28f326ce2d", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect margin\nfrom \"FBS_DB\".\"dbt_dev_marts\".\"mart_sap__sales_orders\"\nwhere margin is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.651701Z", "completed_at": "2026-02-16T12:57:25.656480Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.660806Z", "completed_at": "2026-02-16T12:57:25.660819Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.016903162002563477, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.frontier_analytics.not_null_mart_sap__sales_orders_order_id.b4293b35ec", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect order_id\nfrom \"FBS_DB\".\"dbt_dev_marts\".\"mart_sap__sales_orders\"\nwhere order_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-16T12:57:25.657470Z", "completed_at": "2026-02-16T12:57:25.662166Z"}, {"name": "execute", "started_at": "2026-02-16T12:57:25.662431Z", "completed_at": "2026-02-16T12:57:25.662437Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008305549621582031, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.frontier_analytics.not_null_mart_sap__sales_orders_so_number.b4d781a87b", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect so_number\nfrom \"FBS_DB\".\"dbt_dev_marts\".\"mart_sap__sales_orders\"\nwhere so_number is null\n\n\n", "relation_name": null, "batch_results": null}], "elapsed_time": 0.4444701671600342, "args": {"macro_debugging": false, "select": [], "static": false, "partial_parse_file_diff": true, "printer_width": 80, "log_file_max_bytes": 10485760, "compile": true, "print": true, "introspect": true, "require_batched_execution_for_custom_microbatch_strategy": false, "quiet": false, "partial_parse": true, "require_generic_test_arguments_property": true, "strict_mode": false, "vars": {}, "skip_nodes_if_on_run_start_fails": false, "state_modified_compare_vars": false, "log_format": "default", "require_explicit_package_overrides_for_builtin_materializations": true, "require_ref_searches_node_package_before_root": false, "profiles_dir": "/home/suraj/.dbt", "static_parser": true, "defer": false, "indirect_selection": "eager", "exclude": [], "log_format_file": "debug", "require_resource_names_without_spaces": true, "show_resource_report": false, "empty_catalog": false, "project_dir": "/home/suraj/frontier_analytics", "require_unique_project_resource_names": false, "validate_macro_args": false, "require_yaml_configuration_for_mf_time_spines": false, "log_level": "info", "favor_state": false, "require_nested_cumulative_type_params": false, "upload_to_artifacts_ingest_api": false, "use_colors": true, "use_colors_file": true, "use_fast_test_edges": false, "version_check": true, "log_level_file": "debug", "cache_selected_only": false, "invocation_command": "dbt docs generate", "populate_cache": true, "warn_error_options": {"error": [], "warn": [], "silence": []}, "state_modified_compare_more_unrendered_values": false, "which": "generate", "send_anonymous_usage_stats": true, "write_json": true, "require_all_warnings_handled_by_warn_error": false, "log_path": "/home/suraj/frontier_analytics/logs", "show_all_deprecations": false, "source_freshness_run_project_hooks": true}}